<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Carolina Hurtado-Pulido</title>
</head>

<body>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!--Styles for text along the document-->
    <style> 
        h1 {text-align: center;}
    </style>
    <h1>Compare Raster Values Interactively</h1>
    <div>
        <h2>Carolina Hurtado-Pulido</h2>
        <h3>Final project - Spring/2022 (May/8/2022)</h3>
        <p><b>Justification:</b> Hello! I like to plot my data.</p>
        <p><b>Intructions:</b> Here we have the instructions</p>
    </div>

    <div>
        <image style="display: none;" id="diff" src="/Images/Diff.jpg" width="600" height="600"/>
    </div>

    <canvas id="fig1" x="50" y="50" width="600" height="600"></canvas>
    <canvas id="fig2" x="50" y="50" width="600" height="600"></canvas>

    <div id="display1"></div>

    <script>
        //LOAD HANDLER
        const canvas1=document.querySelector("#fig1");
        const container=canvas1.getContext("2d");
        const imageSource=document.getElementById("diff");
        const worstImage=new Image()

        let svg

        worstImage.src=imageSource.src

        //Draw image on the canvas and fill svg
        worstImage.onload=function CanvasRenderer(){
            container.drawImage(worstImage,0,0);
            svg=d3.select("#display1")
                .append("svg")
                .attr("width", imageSource.width)
                .attr("height", imageSource.height)
                .append("g");
        }
        pixelate(worstImage, 10);

        //FUNCTION TO create array of objects (big ugly pixels)
        function pixelate (image, sizeSquare){
            const x_lenght=image.width/sizeSquare;
            const y_length=image.height/sizeSquare;

            let data=[]; //Array to save color channel values. The array is flat, that is the reason why it jumps every 4

            for(x=0; x<x_lenght; x++){
                for (y=0; y<y_length; y++){
                    const rgba=container.getImageData(x*sizeSquare, y*sizeSquare, sizeSquare, sizeSquare).data;
                    const len=rgba.length; //Number of "new" pixels
                    const num=len/4;

                    let r=0;
                    let g=0;
                    let b=0;

                    for (i=0; i<len; i+=4){
                        r+=rgba[i]
                        g+=rgba[i+1]
                        b+=rgba[i+2]
                    }

                    data.push({
                        x:x*sizeSquare,
                        y:y*sizeSquare,
                        rgb:"rgb("+[Math.round(r/num), Math.round(g/num),Math.round(b/num)].join(",")+")"
                    })
                }
            }
            //drawSvg(data, size);
        }


    </script>

</body>

</html>