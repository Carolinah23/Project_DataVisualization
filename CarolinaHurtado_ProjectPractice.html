<!DOCTYPE html>
<html>
  
<head>
    <title>
        Getting pixel information
        from html canvas.
    </title>
</head>
  
<body>
    <center>
        <h1 style="color:green;">GeeksfoGeeks</h1>
          
        <h3>Getting pixel information from html canvas</h3>
  
        <canvas id="GFG" width="250" height="250" style="border:1px solid black;"></canvas>
  
        <script>
          
          /* Retrieve canvas with id GFG, and store it in a */
          var a = document.getElementById("GFG");
  
          /* Retrieve a 2D context for the canvas */
          var gfg = a.getContext("2d");
  
          var geeks = gfg.createLinearGradient(0, 0, 200, 0);
              
          geeks.addColorStop(0, "green");
          geeks.addColorStop(1, "yellow");
  
          gfg.fillStyle = geeks;
          gfg.fillRect(10, 20, 180, 180);

          var isRegion=false;

          a.addEventListener("mousedown", function(event){
            coord_start=MouseEventLocation(this, event);
            isRegion=true;
            //console.log("down x:",coord_start.x)
            //console.log("down y:",coord_start.y)
          })
          a.addEventListener("mouseup", function(event){
            var RGB=[];
            coord_end=MouseEventLocation(this, event);
            drawRectangle(gfg, coord_start.x, coord_start.y, (coord_end.x-coord_start.x), (coord_end.y-coord_start.y))
            RGB=findPixels(gfg, coord_start.x, coord_start.y, (coord_end.x-coord_start.x), (coord_end.y-coord_start.y))
            stats(RGB[0]);
            stats(RGB[1]);
            stats(RGB[2]);
            isRegion=false;
            //console.log("up x:",coord_end.x)
            //console.log("up y:",coord_end.y)
          })

          //Function that decides if a pixel is in a brush region 
          function drawRectangle(canvasContext, x, y, rect_width, rect_height){
            canvasContext.beginPath();
            canvasContext.rect(x, y, rect_width, rect_height);
            canvasContext.stroke();
          }
  
          /* Define a function find(), that prints the array containing pixel information returned by the getImageData() method */
          function findPixels(canvasContext, x, y, rect_width, rect_height) {
            /* Store the pixel information of the canvas at (x,y) coordinate of (20,20) */
            var ImageData = canvasContext.getImageData(x, y, rect_width, rect_height);
            var dataLength=ImageData.data.length;
            var numberPixels=dataLength/4;
            var Red=[];
            var Green=[];
            var Blue=[];
            for(i=0; i<dataLength; i+=4){
              Red.push(ImageData.data[i]);
              Green.push(ImageData.data[i+1]);
              Blue.push(ImageData.data[i+2]);
              //console.log(i+2)
              //console.log(ImageData.data[i+2]);
            }
            //console.log(ImageData);
            //console.log(numberPixels);
            //console.log(Red);
            //console.log(Green);
            //console.log(Blue);
            //console.log([Red, Green, Blue]);
            return [Red, Green, Blue];
            }
          //Function to calculate mean and standard deviation from pixels
          function stats(array){
            var sum=0;
            var sum_Differences=0;
            for (i=0; i<array.length;i++){
              sum+=array[i];}
            //Means
            var Mean=sum/array.length;
            //std
            for(i=0; i<array.length;i++){
              sum_Differences+=(array[i]-Mean);
            }
            var Std=sum_Differences/array.length;
            console.log("Mean:",Mean)
            console.log("std:",Std)
          }
            
        //Function to return of an object (canvas) in the document
        function CanvasPosition(obj){
            var horizontal=0
            var vertical=0
            if(obj.offsetParent){
                do{
                    horizontal+=obj.offsetLeft;
                    vertical+=obj.offsetTop;
                }while (obj=obj.offsetParent);
                return {x:horizontal, y:vertical};
            }
            return undefined;
        }

        //Function to locate mouse event on canvas
        function MouseEventLocation(object, event){
            var position=CanvasPosition(object);
            return{
                x:(event.pageX-position.x), y:(event.pageY-position.y)
            };
        }
  
        </script>
    </center>
</body>
  
</html>